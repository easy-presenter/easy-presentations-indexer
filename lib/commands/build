#!/bin/bash

#command-info: build index for the easy-presenter

source "$TERMINAL_PATH/app.bootstrap"

index_file_language="$EASY_PRESENTER_SOURCE/README.md"
parent_folder='.'
depth=0

file_clear "$index_file_language"

index_file_init "$index_file_language" "Available languages:"

for language_path in "$EASY_PRESENTER_SOURCE"/*
do
  # if it is a file
  if [ -f "$language_path" ];
  then
    continue
  fi

  language=$(basename "$language_path")

  # write language index file
  file_append "$index_file_language" "  - [$language](./$language)"

  index_file_pages="$language_path/index.md"

  mkdir -p "$language_path/00_index/"
  teaser_for_presentation="$language_path/00_index/01_teaser.md"
  index_file_topics="$language_path/00_index/02_topics.md"

  index_file_init "$index_file_pages"
  command_exec '_build-folder-index' "$language_path" "$index_file_pages" $depth "$parent_folder"

  index_file_init "$index_file_topics" 'Topics'
  command_exec '_build-topic-index' "$language_path" "$index_file_topics" "$parent_folder"

  # concat README.md from page.md and index.md
  readme_for_index="$language_path/README.md"

  cat "$teaser_for_presentation" > "$readme_for_index"
  cat "$index_file_pages" >> "$readme_for_index"
done
